package com.demo;

import java.io.ByteArrayInputStream;
import java.io.File;
import java.io.FileInputStream;
import java.io.IOException;
import java.io.InputStream;

import org.apache.commons.io.IOUtils;
import org.apache.http.HttpEntity;
import org.apache.http.HttpResponse;
import org.apache.http.client.ClientProtocolException;
import org.apache.http.client.HttpClient;
import org.apache.http.client.methods.HttpPost;
import org.apache.http.entity.mime.HttpMultipartMode;
import org.apache.http.entity.mime.MultipartEntityBuilder;
import org.apache.http.entity.mime.content.InputStreamBody;
import org.apache.http.impl.client.HttpClients;

public class ClientDemo {

	public static void main(String[] args) throws ClientProtocolException, IOException {

		String url = "http://localhost:8080/com.navink.wtp.first/FileCounter";
		HttpClient httpclient = HttpClients.createDefault();
		HttpPost httppost = new HttpPost(url);

		InputStream inputStream;
		inputStream = new FileInputStream(new File("build.xml"));

		byte[] data;
		data = IOUtils.toByteArray(inputStream);

		InputStreamBody inputStreamBody = new InputStreamBody(new ByteArrayInputStream(data), "build.xml");

		MultipartEntityBuilder multipartEntity = MultipartEntityBuilder.create();

		multipartEntity.setMode(HttpMultipartMode.BROWSER_COMPATIBLE);
		multipartEntity.addPart("BuildFile", inputStreamBody);
		//Execute and get the response.
		HttpResponse response = httpclient.execute(httppost);
		HttpEntity entity = response.getEntity();

		if (entity != null) {
		    InputStream instream = entity.getContent();
		    try {
		        // do something useful
		    } finally {
		        instream.close();
		    }
		}
	}

}
